{

  "content":"\r\nfunction init($v){\r\n\r\n\tchange_profile(\"buyer\",$v[\"buyer\"]);\r\n\tchange_profile(\"seller\",$v[\"seller\"]);\r\n\tchange_profile(\"mediator\",$v[\"mediator\"]);\r\n\t\r\n}\r\n\r\nfunction condition($v){\r\n\r\n\tif( $v[\"sender\"] != \"buyer\" && $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the buyer or the seller can add a condition.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only add a condition when the contract status is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"condition\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the condition to be added.\";\r\n\t\r\n\t}\r\n\t\r\n\t$conditions = get(\"conditions\");\r\n\t\r\n\t$s[\"conditions\"] = $conditions.\";\".$v[\"sender\"].\":\".$v[\"condition\"];\r\n\t\r\n\tset($s);\r\n\t\r\n\treturn \"Condition added.\";\r\n\t\r\n}\r\n\r\nfunction read_conditions($v){\r\n\r\n\tif( $v[\"sender\"] != \"buyer\" && $v[\"sender\"] != \"seller\" && $v[\"sender\"] != \"mediator\" ){\r\n\t\r\n\t\treturn \"Error: Only the buyer, the seller or the mediator can read the conditions.\";\r\n\t\r\n\t}\r\n\t\r\n\t$conditions = get(\"conditions\");\r\n\t\r\n\treturn \"Conditions: \".$conditions;\r\n\t\r\n}\r\n\r\nfunction change_buyer($v){\r\n\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the buyer when the status of the contract is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"future_buyer\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the new buyer address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif(profile(\"buyer\") == \"empty\"){\r\n\t\r\n\t\tchange_profile(\"buyer\",$v[\"future_buyer\"]);\r\n\t\t\r\n\t\t$s[\"change_buyer\"] = \"0\";\r\n\t\r\n\t\tset($s);\r\n\t\t\t\t\t\r\n\t\treturn \"Buyer changed to: \".$v[\"future_buyer\"];\r\n\t\t\t\r\n\t}else{\r\n\t\r\n\t\tif( $v[\"sender\"] != \"buyer\" ){\r\n\t\t\r\n\t\t\treturn \"Error: Only the buyer can start the change of the buyer address.\";\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\t$s[\"future_buyer\"] = $v[\"future_buyer\"];\r\n\t\t$s[\"change_buyer\"] = \"1\";\r\n\t\t\t\r\n\t\tset($s);\r\n\t\t\t\r\n\t\treturn \"Request to change the buyer has been sent. Now the seller must confirm it.\";\r\n\t\t\r\n\t}\r\n\r\n}\r\n\r\nfunction confirm_change_buyer($v){\r\n\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the buyer when the status of the contract is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the seller can confirm the change of the buyer address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"change_buyer\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the change of the buyer when the buyer has requested it first.\";\r\n\t\r\n\t}\r\n\t\t\r\n\tchange_profile(\"buyer\",get(\"future_buyer\"));\r\n\t\r\n\t$s[\"future_buyer\"] = \"empty\";\r\n\t$s[\"change_buyer\"] = \"0\";\r\n\t\t\r\n\tset($s);\r\n\t\t\r\n\treturn \"Buyer changed to: \".$v[\"future_buyer\"];\r\n\t\r\n}\r\n\r\nfunction change_seller($v){\r\n\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the seller when the status of the contract is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"future_seller\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the new seller address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif(profile(\"seller\") == \"empty\"){\r\n\t\r\n\t\tchange_profile(\"seller\",$v[\"future_seller\"]);\r\n\t\t\r\n\t\t$s[\"change_seller\"] = \"0\";\r\n\t\t\t\r\n\t\tset($s);\r\n\t\t\t\r\n\t\t\r\n\t\treturn \"Seller changed to: \".$v[\"future_seller\"];\r\n\t\t\t\r\n\t}else{\r\n\t\r\n\t\tif( $v[\"sender\"] != \"buyer\" ){\r\n\t\t\r\n\t\t\treturn \"Error: Only the buyer can start the change of the seller address.\";\r\n\t\t\r\n\t\t}\r\n\t\t\t\r\n\t\t$s[\"future_seller\"] = $v[\"future_seller\"];\r\n\t\t$s[\"change_seller\"] = \"1\";\r\n\t\t\t\r\n\t\tset($s);\r\n\t\t\r\n\t\treturn \"Request to change the seller has been sent. Now the seller must confirm it.\";\r\n\t\t\r\n\t}\r\n\r\n}\r\n\r\nfunction confirm_change_seller($v){\r\n\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the seller when the status of the contract is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the seller can confirm the change of the seller address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"change_seller\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the change of the seller when the buyer has requested it first.\";\r\n\t\r\n\t}\r\n\t\t\r\n\tchange_profile(\"seller\",get(\"future_seller\"));\r\n\t\r\n\t$s[\"future_seller\"] = \"empty\";\r\n\t$s[\"change_seller\"] = \"0\";\r\n\t\t\r\n\tset($s);\r\n\t\r\n\t\r\n\treturn \"Buyer changed to: \".$v[\"future_seller\"];\r\n\t\r\n\r\n}\r\n\r\nfunction change_mediator($v){\r\n\r\n\tif( get(\"status\") == \"3\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the mediator when the status of the contract is set to active (1) or Mediation (2).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"future_mediator\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the new mediator address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif(profile(\"mediator\") == \"empty\"){\r\n\t\r\n\t\tchange_profile(\"mediator\",$v[\"future_mediator\"]);\r\n\t\t\r\n\t\t$s[\"change_mediator\"] = \"0\";\r\n\t\t\t\r\n\t\tset($s);\r\n\t\t\r\n\t\t\t\r\n\t\treturn \"Mediator changed to: \".$v[\"future_mediator\"];\r\n\t\t\t\r\n\t}else{\r\n\t\r\n\t\tif( $v[\"sender\"] != \"buyer\" ){\r\n\t\t\r\n\t\t\treturn \"Error: Only the buyer can start the change of the mediator address.\";\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\t$s[\"future_mediator\"] = $v[\"future_mediator\"];\r\n\t\t$s[\"change_mediator\"] = \"1\";\r\n\t\t\t\t\t\r\n\t\tset($s);\r\n\t\t\r\n\t\treturn \"Request to change the mediator has been sent. Now the seller must confirm it.\";\r\n\t\t\r\n\t}\r\n\t\r\n\r\n}\r\n\r\nfunction confirm_change_mediator($v){\r\n\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the seller when the status of the contract is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the seller can confirm the change of the mediator address.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"change_mediator\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the change of the mediator when the buyer has requested it first.\";\r\n\t\r\n\t}\r\n\t\t\r\n\tchange_profile(\"mediator\",get(\"future_mediator\"));\r\n\t\r\n\t$s[\"change_mediator\"] = \"0\";\r\n\t$s[\"future_mediator\"] = \"empty\";\r\n\t\t\t\t\r\n\tset($s);\r\n\t\r\n\treturn \"Buyer changed to: \".$v[\"future_mediator\"];\r\n\r\n}\r\n\r\nfunction end_contract($v){\r\n\r\n\tif( $v[\"sender\"] != \"buyer\" ){\r\n\t\r\n\t\treturn \"Error: Only the buyer can start the end of the contract.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the end of contract when the status is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"end_contract\") == \"1\" ){\r\n\t\r\n\t\treturn \"Error: You have already asked to end the contract.\";\r\n\t\r\n\t}\r\n\t\r\n\t$s[\"end_contract\"] = \"1\";\r\n\t\t\t\t\r\n\tset($s);\r\n\r\n\treturn \"Request to end the contract has been sent. Awaiting for the seller to confirm the end of the contract.\";\r\n\r\n}\r\n\r\nfunction confirm_end_contract($v){\r\n\r\n\tif( $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the seller can confirm the end of the contract.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the end of contract when the status is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"end_contract\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only confirm the end of the contract when the buyer has asked for the end first.\";\r\n\t\r\n\t}\r\n\t\r\n\t$s[\"end_contract\"] = \"0\";\r\n\t$s[\"status\"] = \"3\";\r\n\t\t\t\t\r\n\tset($s);\r\n\r\n\treturn \"Contract ended.\";\r\n\r\n}\r\n\r\n\/\/ mediation\r\n\r\nfunction invoke_mediation($v){\r\n\r\n\tif( $v[\"sender\"] != \"buyer\" && $v[\"sender\"] != \"seller\" ){\r\n\t\r\n\t\treturn \"Error: Only the buyer or the seller can invoke a mediation.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"1\" ){\r\n\t\r\n\t\treturn \"Error: You can only invoke mediation when the contract status is set to active (1).\";\r\n\t\r\n\t}\r\n\t\r\n\t$s[\"status\"] = \"2\";\r\n\t\t\t\t\r\n\tset($s);\r\n\t\r\n\treturn \"Mediation invoked.\";\r\n\t\r\n}\r\n\r\nfunction mediation_end($v){\r\n\r\n\tif( $v[\"sender\"] != \"mediator\"  ){\r\n\t\r\n\t\treturn \"Error: Only the mediator can end a mediation.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"2\" ){\r\n\t\r\n\t\treturn \"Error: You can only end mediation when the contract status is set to mediation (2).\";\r\n\t\r\n\t}\r\n\r\n\t\r\n\t$s[\"status\"] = \"1\";\r\n\t\t\t\t\r\n\tset($s);\r\n\t\r\n\treturn \"Mediation ended.\";\r\n\t\r\n}\r\n\r\nfunction mediation_change_buyer($v){\r\n\r\n\tif( $v[\"sender\"] != \"mediator\"  ){\r\n\t\r\n\t\treturn \"Error: Only the mediator can change the buyer under mediation.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"2\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the buyer under mediation when the contract status is set to mediation (2).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"new_buyer\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the new buyer address.\";\r\n\t\r\n\t}\r\n\t\r\n\tchange_profile(\"buyer\",$v[\"new_buyer\"]);\r\n\t\r\n\treturn \"Buyer changed to: \".$v[\"new_buyer\"];\r\n\t\r\n}\r\n\r\nfunction mediation_change_seller($v){\r\n\r\n\tif( $v[\"sender\"] != \"mediator\"  ){\r\n\t\r\n\t\treturn \"Error: Only the mediator can change the seller under mediation.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"2\" ){\r\n\t\r\n\t\treturn \"Error: You can only change the seller under mediation when the contract status is set to mediation (2).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"new_seller\"]) ){\r\n\t\r\n\t\treturn \"Error: You must inform the new seller address.\";\r\n\t\r\n\t}\r\n\t\r\n\tchange_profile(\"seller\",$v[\"new_seller\"]);\r\n\t\r\n\treturn \"Seller changed to: \".$v[\"new_seller\"];\r\n\r\n}\r\n\r\nfunction mediation_end_contract($v){\r\n\r\n\tif( $v[\"sender\"] != \"mediator\"  ){\r\n\t\r\n\t\treturn \"Only the mediator can end a contract under mediation.\";\r\n\t\r\n\t}\r\n\t\r\n\tif( get(\"status\") != \"2\" ){\r\n\t\r\n\t\treturn \"You can only end the contract under mediation when the contract status is set to mediation (2).\";\r\n\t\r\n\t}\r\n\t\r\n\tif( empty($v[\"decision\"]) ){\r\n\t\r\n\t\treturn \"You can only end the contract informing a decision.\";\r\n\t\r\n\t}\r\n\t\r\n\t$s[\"status\"] = \"3\";\r\n\t$s[\"decision\"] = \"decision\";\r\n\t\t\t\t\r\n\tset($s);\r\n\r\n\treturn \"Contract ended.\";\r\n\t\t\t\r\n}\r\n\r\n\r\n"

}
